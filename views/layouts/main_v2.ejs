<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title><%= typeof title !== 'undefined' ? title : 'Amora Hub' %></title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="<%= locals.pageClass || '' %>">
    <div class="app-container">
        <!-- Desktop Header -->
        <header class="desktop-header">
            <div class="logo">
                <a href="/">Amora Hub</a>
            </div>
            <nav class="desktop-nav">
                <a href="/discover">Discover</a>
                <a href="/matches">Matches</a>
                <a href="/chats">Chats</a>
                <a href="/notifications">Notifications</a>
                <a href="/profile">Profile</a>
            </nav>
            <div class="header-actions">
                <a href="/logout" class="logout-btn">Logout</a>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
        <%- include('../partials/_messages') %>
        <%- body %>
    </div>

    <!-- Mobile Bottom Nav -->
    <div class="bottom-nav">
        <a href="/discover"><i class="fas fa-search"></i><span>Discover</span></a>
        <a href="/matches"><i class="fas fa-heart"></i><span>Matches</span></a>
        <a href="/chats"><i class="fas fa-comments"></i><span>Chats</span></a>
        <a href="/notifications"><i class="fas fa-bell"></i><span>Alerts</span></a>
        <a href="/profile"><i class="fas fa-user"></i><span>Profile</span></a>
    </div>

    <!-- The Image Modal -->
    <div id="image-modal" class="image-modal">
        <span class="image-modal-close">&times;</span>
        <img class="image-modal-content" id="modal-image">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('image-modal');
            const modalImg = document.getElementById('modal-image');
            const closeModal = document.querySelector('.image-modal-close');

            document.addEventListener('click', (e) => {
                // Check if the clicked element is a gallery image
                if (e.target.matches('.gallery-item-v2 img')) {
                    modal.style.display = 'block';
                    modalImg.src = e.target.src;
                }
            });

            const close = () => {
                modal.style.display = 'none';
            }

            closeModal.addEventListener('click', close);
            modal.addEventListener('click', (e) => {
                // Close modal if the background is clicked
                if (e.target === modal) {
                    close();
                }
            });
        });
    </script>

    <!-- Socket.IO Client -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io();

            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 5000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer);
                    toast.addEventListener('mouseleave', Swal.resumeTimer);
                }
            });

            const displayNotification = (notification) => {
                Toast.fire({
                    icon: 'info',
                    title: notification.message,
                    html: `<a href="${notification.link}" style="text-decoration: none; color: inherit;">${notification.message}</a>`,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer);
                        toast.addEventListener('mouseleave', Swal.resumeTimer);
                        if (notification.link) {
                            toast.addEventListener('click', () => {
                                window.location.href = notification.link;
                            });
                        }
                    }
                });
            };

            socket.on('new_notification', displayNotification);
            socket.on('admin_broadcast', displayNotification);
        });
    </script>
</body>
</html>